function res = testLong_zonotope_reduce
% testLong_zonotope_reduce - unit test function of reduce
%
% Syntax:
%    res = testLong_zonotope_reduce
%
% Inputs:
%    -
%
% Outputs:
%    res - true/false
%
% Other m-files required: none
% Subfunctions: none
% MAT-files required: none
%
% See also: -

% Authors:       Matthias Althoff
% Written:       26-July-2016
% Last update:   27-June-2018
%                08-October-2024 (TL, rewrote w/ isequal and smaller tol)
% Last revision: ---

% ------------------------------ BEGIN CODE -------------------------------

% tolerance
tol = 1e-6;

% create zonotope
c = [-1.3; 2.9; 4-2; 3.2];
G = [ ...
0.243, 0.319, 0.022, -0.276, 0.088, -0.019, -0.223, 0.335, -0.517, -0.521, -0.104, 0.659, -0.369, -0.051, -0.746, 0.093, -0.247, 0.119, 0.206, -0.030; ...
-0.436, 0.675, -0.060, -0.209, -0.204, -0.045, -0.008, 0.340, -0.474, 0.252, 0.003, 0.037, 0.817, 0.235, 0.256, 0.019, 0.214, -0.646, 0.739, -0.693; ...
0.259, 0.474, 0.067, -0.760, 0.370, 0.060, -0.042, -0.265, -0.003, -0.153, 0.053, -0.637, -0.214, -0.202, -0.093, 0.013, 0.256, -0.636, -0.191, -0.157; ...
0.589, -0.198, -0.087, 0.371, -0.462, 0.059, 0.162, 0.024, 0.652, 0.757, 0.105, -0.317, 0.260, -0.370, -0.103, 0.104, -0.075, 0.058, 0.054, -0.644];

Zorig = zonotope(c,G);
Zorig_2D = zonotope(c(1:2,:),G(1:2,1:10));


%% cluster - order 1
method = 1;
Zred = reduce(Zorig,'cluster',1,[],method);

% true result
Zmat_true = [ ...
 -1.30000000, 2.61667412, 3.12915242, 3.55702488, 2.98284914 ; ...
 2.90000000, -4.43456072, -0.07303004, 3.88259138, -2.58150239 ; ...
 2.00000000, -4.75879101, 3.76793089, -2.58923006, 1.46230319 ; ...
 3.20000000, 0.88183663, -4.62124969, -1.78909536, 2.60682866 ; ...
 ];
   
% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

% plot
% figure; hold on; box on;
% plot(Zorig); plot(Zred,[1,2],'r'); plot(zonotope(true_mat),[1,2],'g');
% close;

%% cluster - order 3
Zred = reduce(Zorig,'cluster',3,[],method);

% true result
Zmat_true = [ ...
 -1.30000000, 0.24300000, 0.31900000, -0.27600000, -0.51700000, -0.52100000, 0.65900000, -0.36900000, -0.03000000, 1.52388814, 1.70316293, 1.28598928, 1.11284321 ; ...
 2.90000000, -0.43600000, 0.67500000, -0.20900000, -0.47400000, 0.25200000, 0.03700000, 0.81700000, -0.69300000, 2.71396931, -1.33012608, 0.66490233, -0.76693333 ; ...
 2.00000000, 0.25900000, 0.47400000, -0.76000000, -0.00300000, -0.15300000, -0.63700000, -0.21400000, -0.15700000, -1.26724168, -0.47832062, -1.43086265, 1.26430185 ; ...
 3.20000000, 0.58900000, -0.19800000, 0.37100000, 0.65200000, 0.75700000, -0.31700000, 0.26000000, -0.64400000, 0.19561715, 1.31998983, -1.91202871, -1.99811769 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% Combastel - order 1
Zred = reduce(Zorig,'combastel',1);

% true result
Zmat_true = [ ...
 -1.30000000, 5.18700000, 0.00000000, 0.00000000, 0.00000000 ; ...
 2.90000000, 0.00000000, 6.36200000, 0.00000000, 0.00000000 ; ...
 2.00000000, 0.00000000, 0.00000000, 4.90500000, 0.00000000 ; ...
 3.20000000, 0.00000000, 0.00000000, 0.00000000, 5.45100000 ; ...
 ];
   
% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% Combastel - order 3
Zred = reduce(Zorig,'combastel',3);

% true result
Zmat_true = [ ...
 -1.30000000, 0.31900000, -0.27600000, -0.51700000, -0.52100000, 0.65900000, -0.36900000, 0.11900000, -0.03000000, 2.37700000, 0.00000000, 0.00000000, 0.00000000 ; ...
 2.90000000, 0.67500000, -0.20900000, -0.47400000, 0.25200000, 0.03700000, 0.81700000, -0.64600000, -0.69300000, 0.00000000, 2.55900000, 0.00000000, 0.00000000 ; ...
 2.00000000, 0.47400000, -0.76000000, -0.00300000, -0.15300000, -0.63700000, -0.21400000, -0.63600000, -0.15700000, 0.00000000, 0.00000000, 1.87100000, 0.00000000 ; ...
 3.20000000, -0.19800000, 0.37100000, 0.65200000, 0.75700000, -0.31700000, 0.26000000, 0.05800000, -0.64400000, 0.00000000, 0.00000000, 0.00000000, 2.19400000 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% constOpt - order 1
w = warning();
warning('off');
Zred = reduce(Zorig_2D,'constOpt',1);

% true result
Zmat_true = [ ...
 -1.30000000, -2.04290204, -0.90320099 ; ...
 2.90000000, -1.87298949, 1.61135230 ; ...
 ];
   
% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% constOpt - order 3
Zred = reduce(Zorig_2D,'constOpt',3);

% true result
Zmat_true = [ ...
 -1.30000000, 0.31900000, 0.33500000, -0.51700000, -0.52100000, -2.04290204, -0.90320099 ; ...
 2.90000000, 0.67500000, 0.34000000, -0.47400000, 0.25200000, -1.87298949, 1.61135230 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));
warning(w);

%% Girard - order 1
Zred = reduce(Zorig,'girard',1);

% true result
Zmat_true = [ ...
 -1.30000000, 5.18700000, 0.00000000, 0.00000000, 0.00000000 ; ...
 2.90000000, 0.00000000, 6.36200000, 0.00000000, 0.00000000 ; ...
 2.00000000, 0.00000000, 0.00000000, 4.90500000, 0.00000000 ; ...
 3.20000000, 0.00000000, 0.00000000, 0.00000000, 5.45100000 ; ...
 ];
   
% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));


%% Girard - order 3
Zred = reduce(Zorig,'girard',3);

% true result
Zmat_true = [ ...
 -1.30000000, 0.24300000, 0.31900000, -0.27600000, -0.51700000, -0.52100000, 0.65900000, -0.36900000, -0.03000000, 2.25300000, 0.00000000, 0.00000000, 0.00000000 ; ...
 2.90000000, -0.43600000, 0.67500000, -0.20900000, -0.47400000, 0.25200000, 0.03700000, 0.81700000, -0.69300000, 0.00000000, 2.76900000, 0.00000000, 0.00000000 ; ...
 2.00000000, 0.25900000, 0.47400000, -0.76000000, -0.00300000, -0.15300000, -0.63700000, -0.21400000, -0.15700000, 0.00000000, 0.00000000, 2.24800000, 0.00000000 ; ...
 3.20000000, 0.58900000, -0.19800000, 0.37100000, 0.65200000, 0.75700000, -0.31700000, 0.26000000, -0.64400000, 0.00000000, 0.00000000, 0.00000000, 1.66300000 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% MethA - order 1
Zred = reduce(Zorig,'methA',1);

% true result
Zmat_true = [ ...
 -1.30000000, 0.91245292, 1.17016685, 1.95519593, 3.60353219 ; ...
 2.90000000, -2.48850795, -2.09955863, 4.13717008, 0.20232275 ; ...
 2.00000000, 2.77883388, 1.24721488, 2.90521277, -3.48323218 ; ...
 3.20000000, -3.60833653, 2.83633036, -1.21356989, -1.73341382 ; ...
 ];
   
% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% MethA - order 3
Zred = reduce(Zorig,'methA',3);

% true result
Zmat_true = [ ...
 -1.30000000, 0.24300000, 0.31900000, -0.27600000, -0.51700000, -0.52100000, 0.65900000, -0.36900000, -0.03000000, -1.58660430, 0.71947361, -0.19960490, 0.32227971 ; ...
 2.90000000, -0.43600000, 0.67500000, -0.20900000, -0.47400000, 0.25200000, 0.03700000, 0.81700000, -0.69300000, -0.05691854, 2.58102425, 0.91974809, -1.74951843 ; ...
 2.00000000, 0.25900000, 0.47400000, -0.76000000, -0.00300000, -0.15300000, -0.63700000, -0.21400000, -0.15700000, -0.29882233, -0.66708475, -0.79059198, -1.72243610 ; ...
 3.20000000, 0.58900000, -0.19800000, 0.37100000, 0.65200000, 0.75700000, -0.31700000, 0.26000000, -0.64400000, 1.15260043, 0.18859988, -1.44811402, 0.15707751 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% MethB - order 1
Zred = reduce(Zorig,'methB',1,6);

% true result
Zmat_true = [ ...
 -1.30000000, -0.20678368, -3.37623168, -2.48291141, 0.80010339 ; ...
 2.90000000, -4.77670302, -3.09542324, 5.49739463, -4.34341840 ; ...
 2.00000000, -1.08216793, -0.01959129, -1.43995404, -4.27618282 ; ...
 3.20000000, -4.43895634, 4.25783956, 1.74947687, 0.38996636 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% MethB - order 3
Zred = reduce(Zorig,'methB',3,6);

% true result
Zmat_true = [ ...
 -1.30000000, 0.24300000, 0.31900000, -0.27600000, -0.51700000, -0.52100000, 0.65900000, -0.36900000, -0.03000000, 0.27911575, 0.31814946, 1.68745502, -0.19604994 ; ...
 2.90000000, -0.43600000, 0.67500000, -0.20900000, -0.47400000, 0.25200000, 0.03700000, 0.81700000, -0.69300000, -1.51519981, -0.73752829, 1.71264091, 0.90336737 ; ...
 2.00000000, 0.25900000, 0.47400000, -0.76000000, -0.00300000, -0.15300000, -0.63700000, -0.21400000, -0.15700000, -1.49174470, 1.33767385, -1.33485248, -0.77651153 ; ...
 3.20000000, 0.58900000, -0.19800000, 0.37100000, 0.65200000, 0.75700000, -0.31700000, 0.26000000, -0.64400000, 0.13603961, -1.67028465, 0.12089230, -1.42232309 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% MethC - order 1
Zred = reduce(Zorig,'methC',1,[12,6]);

% true result
Zmat_true = [ ...
 -1.30000000, 3.82286456, -3.42360466, 1.97209957, 1.16673238 ; ...
 2.90000000, 0.21463731, 1.65594697, 4.17293796, -2.09339637 ; ...
 2.00000000, -3.69524238, -1.00539638, 2.93032976, 1.24355426 ; ...
 3.20000000, -1.83891968, 4.97441214, -1.22406180, 2.82800564 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% MethC - order 3
Zred = reduce(Zorig,'methC',3,[12,6]);

% true result
Zmat_true = [ ...
 -1.30000000, 0.24300000, 0.31900000, -0.27600000, -0.51700000, -0.52100000, 0.65900000, -0.36900000, -0.03000000, 0.27911575, 0.31814946, 1.68745502, -0.19604994 ; ...
 2.90000000, -0.43600000, 0.67500000, -0.20900000, -0.47400000, 0.25200000, 0.03700000, 0.81700000, -0.69300000, -1.51519981, -0.73752829, 1.71264091, 0.90336737 ; ...
 2.00000000, 0.25900000, 0.47400000, -0.76000000, -0.00300000, -0.15300000, -0.63700000, -0.21400000, -0.15700000, -1.49174470, 1.33767385, -1.33485248, -0.77651153 ; ...
 3.20000000, 0.58900000, -0.19800000, 0.37100000, 0.65200000, 0.75700000, -0.31700000, 0.26000000, -0.64400000, 0.13603961, -1.67028465, 0.12089230, -1.42232309 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% PCA - order 1
Zred = reduce(Zorig,'pca',1);

% true result
Zmat_true = [ ...
 -1.30000000, 0.83577470, 4.04718026, 1.27064186, -2.73170747 ; ...
 2.90000000, -6.28719833, 0.85913351, 1.14708303, 0.08682129 ; ...
 2.00000000, -1.33330571, 1.28350964, -4.63341314, -0.74682999 ; ...
 3.20000000, -0.75680139, -4.92906420, 0.03671766, -2.42230259 ; ...
 ];
   
% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% PCA - order 3
Zred = reduce(Zorig,'pca',3);

% true result
Zmat_true = [ ...
 -1.30000000, 0.24300000, 0.31900000, -0.27600000, -0.51700000, -0.52100000, 0.65900000, -0.36900000, -0.03000000, -0.67169339, -1.90302355, -1.29804065, -0.00227348 ; ...
 2.90000000, -0.43600000, 0.67500000, -0.20900000, -0.47400000, 0.25200000, 0.03700000, 0.81700000, -0.69300000, 2.57392622, -0.93279040, 0.02130890, -0.01921718 ; ...
 2.00000000, 0.25900000, 0.47400000, -0.76000000, -0.00300000, -0.15300000, -0.63700000, -0.21400000, -0.15700000, 0.61627837, 1.59586041, -1.32151626, 0.60563656 ; ...
 3.20000000, 0.58900000, -0.19800000, 0.37100000, 0.65200000, 0.75700000, -0.31700000, 0.26000000, -0.64400000, -0.21399533, -0.65043975, 0.52482913, 1.52014618 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% redistribute - order 1
Zred = reduce(Zorig,'redistribute',1);

% true result
Zmat_true = [ ...
 -1.30000000, -5.55142102, -6.36135301, 4.19180611, -0.23860550 ; ...
 2.90000000, -5.08969741, 3.07689244, 0.23535178, -5.51178700 ; ...
 2.00000000, -0.03221327, -1.86811326, -4.05186721, -1.24870211 ; ...
 3.20000000, 7.00101838, 9.24288720, -2.01639232, -5.12206469 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

%% redistribute - order 3
Zred = reduce(Zorig,'redistribute',3);

% true result
Zmat_true = [ ...
 -1.30000000, 0.54131077, 0.39964328, -0.27600000, 0.13424364, -0.51700000, -0.62181794, 1.34538735, -0.36900000, -0.74600000, 0.14394420, 0.31255416, -0.03000000 ; ...
 2.90000000, -0.97124072, 0.84564016, -0.20900000, -0.31120118, -0.47400000, 0.30076415, 0.07553768, 0.81700000, 0.25600000, -0.78141138, 1.12125013, -0.69300000 ; ...
 2.00000000, 0.57695263, 0.59382731, -0.76000000, 0.56443351, -0.00300000, -0.18260680, -1.30047306, -0.21400000, -0.09300000, -0.76931523, -0.28979536, -0.15700000 ; ...
 3.20000000, 1.31206602, -0.24805445, 0.37100000, -0.70477914, 0.65200000, 0.90348595, -0.64717419, 0.26000000, -0.10300000, 0.07015768, 0.08193167, -0.64400000 ; ...
 ];

% check result
assert(isequal(Zred,zonotope(Zmat_true),tol));

% test completed
res = true;

% ------------------------------ END OF CODE ------------------------------
